<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡å­æŠ¤å«-æ–‡è‰ºå¤å…´ | Quantum Guardians-Renaissance</title>
    <!-- å¼•å…¥ Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- å¼•å…¥ SheetJS -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <!-- å¼•å…¥ Ali-OSS SDK -->
    <script src="https://gosspublic.alicdn.com/aliyun-oss-sdk-6.18.0.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
	<script>
		var _hmt = _hmt || [];
		(function() {
		  var hm = document.createElement("script");
		  hm.src = "https://hm.baidu.com/hm.js?1458aabb915f9bf50f1aa519f3d75485";
		  var s = document.getElementsByTagName("script")[0]; 
		  s.parentNode.insertBefore(hm, s);
		})();
	</script>
    <style>
        /* --- åŸºç¡€æ ·å¼ --- */
        :root {
            --bg-color: #050510;
            --panel-bg: #111122;
            --text-main: #e0e0e0;
            --genbu-color: #10B981;
            --suzaku-color: #EF4444;
            --sirius-color: #8B5CF6;
            --kirin-color: #3B82F6;
            --user-gold: #FFD700;
        }
        * { box-sizing: border-box; }

        /* Body åŸºç¡€æ ·å¼ä¿æŒï¼Œä½†ä¸å†è´Ÿè´£ Flex å¸ƒå±€ï¼ŒFlex ç§»äº¤ç»™ main-scaler */
        body { 
            background-color: var(--bg-color); 
            color: var(--text-main); 
            font-family: 'Roboto Mono', monospace; 
            margin: 0; 
            padding: 0; /* padding ç§»äº¤ç»™å†…éƒ¨å®¹å™¨ */
            min-height: 100vh; 
        }

        /* æ–°å¢ï¼šåŒ…è£¹å±‚é»˜è®¤æ ·å¼ï¼Œç»§æ‰¿åŸæœ¬ body çš„ flex å¸ƒå±€ç‰¹æ€§ */
        .main-scaler {
            padding: 20px;
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            min-height: 100vh;
            width: 100%;
        }

        h1, .pixel-font { font-family: 'Press Start 2P', cursive; text-transform: uppercase; }
        
        /* --- Header --- */
        .header { 
            text-align: center; margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 20px; 
            width: 100%; max-width: 1400px; position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .container { max-width: 1400px; width: 100%; display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; margin-bottom: 20px; }
        
        /* --- å¡ç‰‡æ ·å¼ --- */
        .guardian-card { background: var(--panel-bg); border: 2px solid #444; padding: 15px; border-radius: 4px; display: flex; flex-direction: column; transition: all 0.3s; box-shadow: 0 0 10px rgba(0,0,0,0.5); min-height: 800px; transition: all 0.3s ease; }
        .guardian-card.active { border-color: var(--glow-color); box-shadow: 0 0 20px var(--glow-color); }
        .g-genbu { --glow-color: var(--genbu-color); }
        .g-suzaku { --glow-color: var(--suzaku-color); }
        .g-sirius { --glow-color: var(--sirius-color); }
        .g-kirin { --glow-color: var(--kirin-color); }
        
        .card-header { display: flex; align-items: center; border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 10px; }
        .avatar { font-size: 2.5em; margin-right: 15px; text-shadow: 0 0 10px var(--glow-color); }
        .role-info h2 { margin: 0; font-size: 1.2em; color: var(--glow-color); }
        .role-desc { font-size: 0.6em; color: #888; }
        
        .main-stat-box { background: rgba(0,0,0,0.3); border: 1px solid #333; padding: 10px; text-align: center; margin-bottom: 10px; }
        .stat-group { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 5px; }
        .stat-label { font-size: 0.6em; color: #aaa; text-transform: uppercase; }
        .stat-value { font-size: 1.2em; font-weight: bold; color: #fff; }
        
        .user-stat { color: var(--user-gold); text-shadow: 0 0 5px rgba(255, 215, 0, 0.3); }
        .sub-stat { font-size: 0.7em; color: #fff; margin-top: 5px; border-top: 1px dashed #333; padding-top: 5px; font-weight: bold;}
        
        /* --- åˆ—è¡¨åŒºåŸŸ --- */
        .list-header { font-size: 0.6em; color: #888; margin-top: 5px; margin-bottom: 2px; text-transform: uppercase; letter-spacing: 1px; }
        .holdings-list { flex-grow: 1; overflow-y: auto; border: 1px dashed #333; background: rgba(0,0,0,0.2); padding: 5px; height: 200px; margin-bottom: 10px; }
        .portfolio-list { height: 200px; border: 1px solid #444; background: #000; }
        .adhoc-list { height: 150px; border-style: dotted; border-color: #555; }

        /* --- åˆ—è¡¨é¡¹ --- */
        .holding-item { 
            display: grid; grid-template-columns: 1.4fr 0.8fr 1fr; 
            background: #1a1a2e; margin-bottom: 4px; padding: 6px; 
            border-left: 3px solid #444; cursor: pointer; transition: background 0.2s; 
            align-items: center; user-select: none; 
        }
        .holding-item:hover { background: #252540; }
        .holding-item.selected { background: #303050; border-left-color: #fff; }
        .holding-item.is-cash { border-left-color: var(--user-gold); background: #1a1a10; }

        .h-info { display: flex; flex-direction: column; justify-content: center; }
        .h-name { font-weight: bold; font-size: 0.8em; color: #ddd; display: block; margin-bottom: 2px;} 
        .h-weight-row { display: flex; align-items: center; font-size: 0.7em; }
        .h-weight { color: #aaa; margin-right: 8px; }
        .user-weight-display { color: var(--user-gold); font-weight: bold; }
        .h-price-col { text-align: right; display: flex; flex-direction: column; justify-content: center; padding-right: 5px;}
        .h-price { font-size: 0.8em; font-weight: bold; }
        .h-pct { font-size: 0.65em; }
        .text-up { color: #EF4444; }
        .text-down { color: #10B981; }
        
        .mini-chart-container { position: relative; width: 100%; height: 30px; cursor: crosshair; }
        .mini-chart-container:hover { border: 1px solid #666; }
        canvas.sparkline { width: 100%; height: 100%; }

        /* --- Commander Section --- */
        .commander-section { margin-top: 10px; border-top: 1px solid #333; padding-top: 10px; }
        .cmd-row { margin-bottom: 10px; }
        .cmd-top-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2px; }
        .cmd-label { font-size: 0.6em; color: var(--glow-color); font-weight: bold; }
        .cmd-label-sell { color: var(--glow-color); }
        .calc-res { font-size: 0.6em; color: var(--user-gold); }
        
        .cmd-controls { display: flex; gap: 4px; width: 100%; align-items: center; }
        .cmd-input { background: #000; border: 1px solid #555; color: #fff; font-family: 'Roboto Mono'; padding: 4px; font-size: 0.7em; height: 26px; }
        .input-price { flex: 1; min-width: 0; }
        .input-weight { width: 60px; flex: 0 0 60px; color: var(--user-gold); text-align: center; }
        .cmd-btn { 
            cursor: pointer; font-family: 'Press Start 2P'; font-size: 0.5em; 
            width: 85px !important; flex: 0 0 85px !important; min-width: 85px !important;
            height: 26px; white-space: nowrap; border: 1px solid #555; background: #222; color: #fff;
            padding: 0; text-align: center; box-sizing: border-box; 
        }
        .cmd-btn.buy-btn { border-color: var(--glow-color); color: var(--glow-color); }
        .cmd-btn.sell-btn { border-color: var(--glow-color); color: var(--glow-color); }
        .cmd-btn:disabled { opacity: 0.3; cursor: not-allowed; border-color: #444; color: #666; }
        .cmd-msg { height: 15px; font-size: 0.6em; margin-top: -5px; margin-bottom: 10px; color: #ffff00; text-align: left;}

        /* --- System Controls --- */
        .settlement-panel { width: 100%; max-width: 1400px; background: var(--panel-bg); border: 2px solid #555; padding: 20px; margin-bottom: 20px; display: none; }
        .chart-wrapper { position: relative; height: 300px; width: 100%; }
        .system-controls { margin-top: 10px; text-align: center; width: 100%; max-width: 800px; }
        .start-btn { 
            background: #000; color: #0f0; border: 2px solid #0f0; padding: 15px 40px; 
            font-family: 'Press Start 2P'; font-size: 1.2em; cursor: pointer; 
            box-shadow: 0 0 10px #0f0; margin-bottom: 10px; max-width: 100%; overflow: hidden;
        }
        .log-box { background: #000; border: 1px solid #333; height: 100px; overflow-y: scroll; text-align: left; padding: 10px; font-size: 0.75em; color: #0f0; }
        .log-line { border-bottom: 1px solid #111; padding: 2px 0; }

		@media (max-width: 768px) {
            .header { position: static; padding-top: 10px; }
            /* åŸæ¥çš„ .oss-btn é‚£ä¸€è¡Œåˆ æ‰äº†ï¼Œå› ä¸ºç°åœ¨ç»Ÿä¸€åœ¨ header-controls é‡Œç®¡ç†äº† */
            .header-controls { position: relative; right: auto; top: auto; margin-top: 15px; justify-content: center;}
        }
        
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #333; }

        /* --- æ¨¡æ€æ¡†é€šç”¨ --- */
        .modal-overlay {
            display: none;
            position: fixed; /* å¿…é¡»æ˜¯ fixed */
            top: 0; left: 0;
            width: 100%; height: 100%; /* é»˜è®¤çŠ¶æ€ */
            background: rgba(0,0,0,0.85);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(2px);
        }
        .modal-content {
            background: #111; border: 2px solid #fff; padding: 20px;
            width: 90%; max-width: 900px; height: 60vh;
            border-radius: 8px; display: flex; flex-direction: column;
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
        }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .close-btn { background: #333; border: 1px solid #555; color: #fff; padding: 8px 16px; cursor: pointer; font-family: 'Roboto Mono'; font-weight: bold; }
        .close-btn:hover { background: #444; }
        .detail-chart-wrapper { flex-grow: 1; position: relative; width: 100%; }

        /* --- ADHOC æœç´¢å»ºè®® --- */
        .adhoc-results-container { position: relative; }
        .suggestions-list-container {
            position: absolute; top: calc(100% + 2px); left: 0; width: 100%; z-index: 1000;
            background: #111; border: 1px solid #555; border-radius: 4px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.8); max-height: 200px; overflow-y: auto; display: block;
        }
        .suggestions-list { list-style: none; margin: 0; padding: 0; }
        .suggestions-list li { padding: 8px 12px; font-size: 0.7em; cursor: pointer; border-bottom: 1px solid #222; color: #e0e0e0; }
        .suggestions-list li:hover { background: #333; color: var(--user-gold); }
        .delete-btn { color: #ffff00; cursor: pointer; margin-left: 5px; font-size: 1.2em; font-weight: bold; line-height: 1; vertical-align: middle; display: inline-block; transition: transform 0.2s; }
        .delete-btn:hover { transform: scale(1.3); color: #FFD700; }
        .h-name-wrapper { display: flex; align-items: center; }

		/* --- Header Controls Group --- */
		.header-controls { position: relative; right: auto; top: auto; margin-top: 20px; display: flex; gap: 8px; align-items: center; justify-content: center; }
		/* --- ç»Ÿä¸€çš„å›¾æ ‡æŒ‰é’®æ ·å¼ --- */
        .icon-btn {
            background: #222; 
            border: 1px solid #555; 
            color: #aaa; 
            width: 38px; 
            height: 38px;
            display: flex; 
            justify-content: center; 
            align-items: center; 
            cursor: pointer; 
            border-radius: 4px; 
            transition: all 0.2s; 
            font-size: 1.2em;
            position: relative; /* å…³é”®ï¼šä¸ºå†…éƒ¨çš„å°çº¢ç‚¹æä¾›å®šä½åŸºå‡† */
            padding: 0; /* æ¸…é™¤é»˜è®¤å†…è¾¹è· */
        }

        /* é¼ æ ‡æ‚¬åœçŠ¶æ€ - ç»Ÿä¸€ä¸ºç™½è‰²é«˜äº® */
        .icon-btn:hover { 
            background: #333; 
            color: #fff; 
            border-color: #fff; 
            transform: scale(1.1); 
            box-shadow: 0 0 10px rgba(255,255,255,0.3); 
        }

        /* é¼ æ ‡ç‚¹å‡»æŒ‰ä¸‹çŠ¶æ€ - ç»Ÿä¸€æ•ˆæœ */
        .icon-btn:active {
            background: #444;
            border-color: #fff;
            transform: scale(0.95); /* ç‚¹å‡»æ—¶è½»å¾®ç¼©å°ï¼Œäº§ç”ŸæŒ‰å‹æ„Ÿ */
        }

        /* --- äº‘åŒæ­¥çŠ¶æ€æŒ‡ç¤ºç¯ (å³ä¸Šè§’æ‚¬æµ®å°ç‚¹) --- */
        .oss-status { 
            width: 8px; 
            height: 8px; 
            border-radius: 50%; 
            background: #666; /* é»˜è®¤ç°è‰² */
            display: block; 
            
            /* ç»å¯¹å®šä½åˆ°æŒ‰é’®å³ä¸Šè§’ */
            position: absolute; 
            top: 4px; 
            right: 4px; 
            z-index: 2;
            border: 1px solid #222; /* å¢åŠ é»‘è‰²æè¾¹ï¼Œå¢åŠ å¯¹æ¯”åº¦ */
        }
        
        /* çŠ¶æ€é¢œè‰²åŠ¨ç”»ä¿æŒä¸å˜ */
        .oss-status.syncing { background: #ff0; box-shadow: 0 0 5px #ff0; animation: blink 1s infinite; }
        .oss-status.done { background: #0f0; box-shadow: 0 0 5px #0f0; }
        @keyframes blink { 50% { opacity: 0.5; } }        
        /* ç§»é™¤åŸæ¥çš„ .oss-btn æ ·å¼ï¼Œå› ä¸ºå®ƒç°åœ¨å·²ç»åˆå¹¶è¿› .icon-btn äº† */
	
		/* --- Settings Modal --- */
		.setting-row { display: flex; align-items: center; justify-content: space-between; padding: 15px; border-bottom: 1px solid #333; font-family: 'Roboto Mono'; }
		.switch-label { color: #e0e0e0; font-size: 1em; }
		
		/* --- Ranking Modal --- */
		.rank-list { padding: 10px; overflow-y: auto; height: 100%; }
		.rank-item { display: flex; align-items: center; margin-bottom: 15px; opacity: 0; animation: slideIn 0.6s forwards; }
		.rank-info { width: 100px; text-align: right; padding-right: 10px; display: flex; flex-direction: column; align-items: flex-end; }
		.rank-name { font-size: 0.8em; font-weight: bold; color: #fff; }
		.rank-icon { font-size: 1.2em; margin-top: 2px; }
		.rank-bar-area { flex-grow: 1; position: relative; height: 26px; background: rgba(255,255,255,0.05); border-radius: 4px; display: flex; align-items: center; }
		.rank-bar {
		    height: 100%; border-radius: 4px; width: 0%; transition: width 1.2s cubic-bezier(0.22, 0.61, 0.36, 1);
		    position: relative; box-shadow: 0 0 10px rgba(0,0,0,0.5);
		}
		.rank-val { position: absolute; right: 10px; color: #fff; font-weight: bold; font-size: 0.9em; text-shadow: 1px 1px 2px #000; z-index: 2; }
		.rank-trophy { position: absolute; right: -40px; font-size: 1.5em; filter: drop-shadow(0 0 5px gold); animation: bounce 1s infinite alternate; }
		@keyframes slideIn { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }
		@keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-5px); } }
		
		/* --- 2. ä»…é’ˆå¯¹ç”µè„‘ç«¯ (å±å¹•å®½åº¦å¤§äº 1024px) å¼€å¯ç¼©æ”¾ --- */
		@media (min-width: 1024px) {
		    body {
		        /* ã€ä¿®æ”¹ç‚¹ 1ã€‘body ä¸å†ç¼©æ”¾ï¼Œä¿æŒé»˜è®¤ï¼Œä½œä¸º Viewport å®¹å™¨ */
		        transform: none;
		        width: 100%;
		        height: 100vh;
		        overflow-x: hidden;
		        overflow-y: auto;
		    }

            /* ã€ä¿®æ”¹ç‚¹ 2ã€‘æ–°å¢ï¼šå¯¹åŒ…è£¹å†…å®¹çš„å®¹å™¨è¿›è¡Œç¼©æ”¾ */
            .main-scaler {
		        /* ä½¿ç”¨ transform è¿›è¡Œæ ‡å‡†ç¼©æ”¾ */
		        transform: scale(0.9);
		        
		        /* è®¾å®šç¼©æ”¾åŸç‚¹ä¸ºå·¦ä¸Šè§’ */
		        transform-origin: 0 0;
		        
		        /* å®½åº¦è¡¥å¿ï¼šå®¹å™¨å®½åº¦è®¾ä¸º 100% / 0.9 â‰ˆ 111.11% æ‰èƒ½å¡«æ»¡å±å¹• */
		        width: 111.11%;
		        
		        /* é«˜åº¦è¡¥å¿ */
		        min-height: 111.11vh; 
            }
		
		    /* ã€ä¿®æ”¹ç‚¹ 3ã€‘æ¨¡æ€æ¡†æ ·å¼ä¿®å¤ */
            /* ç°åœ¨çš„ .modal-overlay æ˜¯ body çš„ç›´æ¥å­å…ƒç´ ï¼Œä¸” body æ²¡æœ‰ transform */
            /* æ‰€ä»¥ fixed å®šä½ä¼šæ­£ç¡®ç›¸å¯¹äºæµè§ˆå™¨çª—å£ */
		    .modal-overlay {
		        width: 100vw; 
		        height: 100vh;
                left: 0;
                top: 0;
		    }
		}
    </style>
</head>
<body>	
	<!-- æ”¾åœ¨ body æ ‡ç­¾å†…ä»»æ„ä½ç½®ï¼Œä¾‹å¦‚ main-scaler å¼€å§‹ä¹‹å‰ -->
	<audio id="bgMusic" loop>
		<!-- è¯·å°†æ­¤å¤„æ›¿æ¢ä¸ºä½ çš„éŸ³ä¹æ–‡ä»¶è·¯å¾„ -->
		<!--source src="Ennio Morricone - Deborah's Theme.mp3" type="audio/mpeg"-->
	</audio>
    <!-- ã€NEWã€‘æ–°å¢åŒ…è£¹å±‚ï¼ŒåŒ…å«åŸæ¥çš„ä¸»è¦é¡µé¢å†…å®¹ -->
    <div class="main-scaler">
        
        <div class="header">
            <h1>Quantum Guardians</h1>
            <div class="pixel-font" style="font-size: 0.7em; color: #666; margin-top:5px;">Intelligent Quant Battle System v1.0</div>
            <!-- æ–°å¢çš„æŒ‰é’®ç»„å®¹å™¨ -->
            <div class="header-controls">
                <!-- 1. è®¾ç½®å›¾æ ‡æŒ‰é’® (æœ€å·¦) -->
                <button class="icon-btn" onclick="openSettings()" title="Settings">âš™ï¸</button>
                
                <!-- 2. æ’åºå›¾æ ‡æŒ‰é’® -->
                <button class="icon-btn" onclick="openRanking()" title="Battle Ranking">ğŸ†</button>
				 <!-- ã€NEWã€‘3. æ–°å¢ MP3 æ’­æ”¾/åœæ­¢æŒ‰é’® -->
                <!-- ä½¿ç”¨ icon-btn ç±»ç¡®ä¿é«˜åº¦å’Œæ ·å¼ä¸€è‡´ -->
                <button class="icon-btn" onclick="toggleMusic()" id="musicBtn" title="Play Music">ğŸ¼</button>
				
                
                <!-- 3. åŸæœ‰çš„ SYNC CLOUD æŒ‰é’® -->
				<button class="icon-btn" onclick="syncToCloud()" title="Sync Cloud" style="position: relative;">
                    â˜ï¸
                    <span class="oss-status" id="ossStatusDot"></span>
                </button>

				<!-- ã€NEWã€‘5. æ–°å¢ï¼šç‚¹å‡»é©±åŠ¨è®¡ç®—æ”¶ç›ŠæŒ‰é’® -->
                <!-- ä½¿ç”¨ ğŸ§® (ç®—ç›˜/è®¡ç®—) æˆ– ğŸ’¹ (æ”¶ç›Šå›¾è¡¨) ä½œä¸ºå›¾æ ‡ -->
                <button class="icon-btn" onclick="triggerCalculation()" title="Calculate Returns">ğŸ§®</button>
				
            </div>
        </div>

        <div class="container">
            <!-- SUZAKU -->
            <div class="guardian-card g-suzaku" id="card-suzaku">
                <div class="card-header"><div class="avatar">ğŸ”¥</div><div class="role-info"><h2 class="pixel-font">SUZAKU</h2><div class="role-desc">DaCheng (å¤§æˆ)</div></div></div>
                <div class="main-stat-box">
                    <div class="stat-group"><span class="stat-label">System Rtn:</span><span class="stat-value" id="rtn-suzaku">--.--%</span></div>
                    <div class="stat-group"><span class="stat-label" style="color:#ffd700;">User Rtn:</span><span class="stat-value user-stat" id="user-rtn-suzaku">0.00%</span></div>
                    <div class="sub-stat">Power: <span id="power-suzaku">0%</span></div>
                </div>
                <div class="list-header">PORTFOLIO HOLDINGS (SYSTEM)</div>
                <div class="holdings-list" id="list-suzaku"></div>
                
                <!-- ADHOC -->
                <div class="list-header">ADDHOC OBSERVATIONS (USER)</div>
                <div class="holdings-list adhoc-list" id="adhoc-list-suzaku"></div>

                <div class="commander-section">
                    <div class="cmd-row">
                        <div class="cmd-top-row"><span class="cmd-label">Buy COMMANDER:</span><span class="calc-res" id="calc-buy-suzaku"></span></div>
                        <div class="cmd-controls">
                            <input type="number" class="cmd-input input-price" id="buy-price-suzaku" placeholder="Price" oninput="calcQty('suzaku', 'buy')">
                            <input type="number" class="cmd-input input-weight" id="buy-weight-suzaku" placeholder="%" oninput="calcQty('suzaku', 'buy')">
                            <button class="cmd-btn buy-btn" id="btn-buy-suzaku" onclick="executeOrder('suzaku', 'buy')">CONFIRM</button>
                        </div>
                    </div>
                    <div class="cmd-row">
                        <div class="cmd-top-row"><span class="cmd-label cmd-label-sell">Sell COMMANDER:</span><span class="calc-res" id="calc-sell-suzaku"></span></div>
                        <div class="cmd-controls">
                            <input type="number" class="cmd-input input-price" id="sell-price-suzaku" placeholder="Price" oninput="calcQty('suzaku', 'sell')">
                            <input type="number" class="cmd-input input-weight" id="sell-weight-suzaku" placeholder="%" oninput="calcQty('suzaku', 'sell')">
                            <button class="cmd-btn sell-btn" id="btn-sell-suzaku" onclick="executeOrder('suzaku', 'sell')">CONFIRM</button>
                        </div>
                    </div>
                    <!-- ADHOC CMD -->
                    <div class="cmd-row">
                        <div class="cmd-top-row"><span class="cmd-label">ADHOC COMMANDER:</span></div>
                        <div class="cmd-controls adhoc-results-container">
                            <input type="text" class="cmd-input input-price" id="adhoc-search-suzaku" placeholder="Name/Code">
                            <input type="number" class="cmd-input input-weight" id="adhoc-weight-suzaku" placeholder="%" step="0.1">
                            <button class="cmd-btn buy-btn" onclick="addNewAdhoc('suzaku')">ADHOC</button>
                            <div id="suggestions-suzaku" class="suggestions-list-container"></div>
                        </div>
                    </div>
                    <div class="cmd-msg" id="msg-suzaku"></div>
                </div>
                <div class="list-header">PORTFOLIO HOLDINGS (USER)</div>
                <div class="holdings-list portfolio-list" id="portfolio-suzaku"></div>
            </div>

            <!-- SIRIUS -->
            <div class="guardian-card g-sirius" id="card-sirius">
                <div class="card-header"><div class="avatar">ğŸº</div><div class="role-info"><h2 class="pixel-font">SIRIUS</h2><div class="role-desc">Inflow (æµå…¥)</div></div></div>
                <div class="main-stat-box">
                    <div class="stat-group"><span class="stat-label">System Rtn:</span><span class="stat-value" id="rtn-sirius">--.--%</span></div>
                    <div class="stat-group"><span class="stat-label" style="color:#ffd700;">User Rtn:</span><span class="stat-value user-stat" id="user-rtn-sirius">0.00%</span></div>
                    <div class="sub-stat">Power: <span id="power-sirius">0%</span></div>
                </div>
                <div class="list-header">PORTFOLIO HOLDINGS (SYSTEM)</div>
                <div class="holdings-list" id="list-sirius"></div>

                <!-- ADHOC -->
                <div class="list-header">ADDHOC OBSERVATIONS (USER)</div>
                <div class="holdings-list adhoc-list" id="adhoc-list-sirius"></div>

                <div class="commander-section">
                    <div class="cmd-row">
                        <div class="cmd-top-row"><span class="cmd-label">Buy COMMANDER:</span><span class="calc-res" id="calc-buy-sirius"></span></div>
                        <div class="cmd-controls">
                            <input type="number" class="cmd-input input-price" id="buy-price-sirius" placeholder="Price" oninput="calcQty('sirius', 'buy')">
                            <input type="number" class="cmd-input input-weight" id="buy-weight-sirius" placeholder="%" oninput="calcQty('sirius', 'buy')">
                            <button class="cmd-btn buy-btn" id="btn-buy-sirius" onclick="executeOrder('sirius', 'buy')">CONFIRM</button>
                        </div>
                    </div>
                    <div class="cmd-row">
                        <div class="cmd-top-row"><span class="cmd-label cmd-label-sell">Sell COMMANDER:</span><span class="calc-res" id="calc-sell-sirius"></span></div>
                        <div class="cmd-controls">
                            <input type="number" class="cmd-input input-price" id="sell-price-sirius" placeholder="Price" oninput="calcQty('sirius', 'sell')">
                            <input type="number" class="cmd-input input-weight" id="sell-weight-sirius" placeholder="%" oninput="calcQty('sirius', 'sell')">
                            <button class="cmd-btn sell-btn" id="btn-sell-sirius" onclick="executeOrder('sirius', 'sell')">CONFIRM</button>
                        </div>
                    </div>
                    <!-- ADHOC CMD -->
                    <div class="cmd-row">
                        <div class="cmd-top-row"><span class="cmd-label">ADHOC COMMANDER:</span></div>
                        <div class="cmd-controls adhoc-results-container">
                            <input type="text" class="cmd-input input-price" id="adhoc-search-sirius" placeholder="Name/Code">
                            <input type="number" class="cmd-input input-weight" id="adhoc-weight-sirius" placeholder="%" step="0.1">
                            <button class="cmd-btn buy-btn" onclick="addNewAdhoc('sirius')">ADHOC</button>
                            <div id="suggestions-sirius" class="suggestions-list-container"></div>
                        </div>
                    </div>
                    <div class="cmd-msg" id="msg-sirius"></div>
                </div>
                <div class="list-header">PORTFOLIO HOLDINGS (USER)</div>
                <div class="holdings-list portfolio-list" id="portfolio-sirius"></div>
            </div>

            <!-- GENBU -->
            <div class="guardian-card g-genbu" id="card-genbu">
                <div class="card-header"><div class="avatar">ğŸ¢</div><div class="role-info"><h2 class="pixel-font">GENBU</h2><div class="role-desc">LowVol (ä½æ³¢)</div></div></div>
                <div class="main-stat-box">
                    <div class="stat-group"><span class="stat-label">System Rtn:</span><span class="stat-value" id="rtn-genbu">--.--%</span></div>
                    <div class="stat-group"><span class="stat-label" style="color:#ffd700;">User Rtn:</span><span class="stat-value user-stat" id="user-rtn-genbu">0.00%</span></div>
                    <div class="sub-stat">Power: <span id="power-genbu">0%</span></div>
                </div>
                <div class="list-header">PORTFOLIO HOLDINGS (SYSTEM)</div>
                <div class="holdings-list" id="list-genbu"></div>
                
                <!-- ADHOC -->
                <div class="list-header">ADDHOC OBSERVATIONS (USER)</div>
                <div class="holdings-list adhoc-list" id="adhoc-list-genbu"></div>

                <div class="commander-section">
                    <div class="cmd-row">
                        <div class="cmd-top-row"><span class="cmd-label">Buy COMMANDER:</span><span class="calc-res" id="calc-buy-genbu"></span></div>
                        <div class="cmd-controls">
                            <input type="number" class="cmd-input input-price" id="buy-price-genbu" placeholder="Price" oninput="calcQty('genbu', 'buy')">
                            <input type="number" class="cmd-input input-weight" id="buy-weight-genbu" placeholder="%" oninput="calcQty('genbu', 'buy')">
                            <button class="cmd-btn buy-btn" id="btn-buy-genbu" onclick="executeOrder('genbu', 'buy')">CONFIRM</button>
                        </div>
                    </div>
                    <div class="cmd-row">
                        <div class="cmd-top-row"><span class="cmd-label cmd-label-sell">Sell COMMANDER:</span><span class="calc-res" id="calc-sell-genbu"></span></div>
                        <div class="cmd-controls">
                            <input type="number" class="cmd-input input-price" id="sell-price-genbu" placeholder="Price" oninput="calcQty('genbu', 'sell')">
                            <input type="number" class="cmd-input input-weight" id="sell-weight-genbu" placeholder="%" oninput="calcQty('genbu', 'sell')">
                            <button class="cmd-btn sell-btn" id="btn-sell-genbu" onclick="executeOrder('genbu', 'sell')">CONFIRM</button>
                        </div>
                    </div>     
                    <!-- ADHOC CMD -->
                    <div class="cmd-row">
                        <div class="cmd-top-row"><span class="cmd-label">ADHOC COMMANDER:</span></div>
                        <div class="cmd-controls adhoc-results-container">
                            <input type="text" class="cmd-input input-price" id="adhoc-search-genbu" placeholder="Name/Code">
                            <input type="number" class="cmd-input input-weight" id="adhoc-weight-genbu" placeholder="%" step="0.1">
                            <button class="cmd-btn buy-btn" onclick="addNewAdhoc('genbu')">ADHOC</button>
                            <div id="suggestions-genbu" class="suggestions-list-container"></div>
                        </div>
                    </div>
                    <div class="cmd-msg" id="msg-genbu"></div>
                </div>
                <div class="list-header">PORTFOLIO HOLDINGS (USER)</div>
                <div class="holdings-list portfolio-list" id="portfolio-genbu"></div>
            </div>

            <!-- KIRIN -->
            <div class="guardian-card g-kirin" id="card-kirin">
                <div class="card-header"><div class="avatar">ğŸ¦„</div><div class="role-info"><h2 class="pixel-font">KIRIN</h2><div class="role-desc">DaZhi (å¤§æ™º)</div></div></div>
                <div class="main-stat-box">
                    <div class="stat-group"><span class="stat-label">System Rtn:</span><span class="stat-value" id="rtn-kirin">--.--%</span></div>
                    <div class="stat-group"><span class="stat-label" style="color:#ffd700;">User Rtn:</span><span class="stat-value user-stat" id="user-rtn-kirin">0.00%</span></div>
                    <div class="sub-stat">Power: <span id="power-kirin">0%</span></div>
                </div>
                <div class="list-header">PORTFOLIO HOLDINGS (SYSTEM)</div>
                <div class="holdings-list" id="list-kirin"></div>

                <!-- ADHOC -->
                <div class="list-header">ADDHOC OBSERVATIONS (USER)</div>
                <div class="holdings-list adhoc-list" id="adhoc-list-kirin"></div>

                <div class="commander-section">
                    <div class="cmd-row">
                        <div class="cmd-top-row"><span class="cmd-label">Buy COMMANDER:</span><span class="calc-res" id="calc-buy-kirin"></span></div>
                        <div class="cmd-controls">
                            <input type="number" class="cmd-input input-price" id="buy-price-kirin" placeholder="Price" oninput="calcQty('kirin', 'buy')">
                            <input type="number" class="cmd-input input-weight" id="buy-weight-kirin" placeholder="%" oninput="calcQty('kirin', 'buy')">
                            <button class="cmd-btn buy-btn" id="btn-buy-kirin" onclick="executeOrder('kirin', 'buy')">CONFIRM</button>
                        </div>
                    </div>
                    <div class="cmd-row">
                        <div class="cmd-top-row"><span class="cmd-label cmd-label-sell">Sell COMMANDER:</span><span class="calc-res" id="calc-sell-kirin"></span></div>
                        <div class="cmd-controls">
                            <input type="number" class="cmd-input input-price" id="sell-price-kirin" placeholder="Price" oninput="calcQty('kirin', 'sell')">
                            <input type="number" class="cmd-input input-weight" id="sell-weight-kirin" placeholder="%" oninput="calcQty('kirin', 'sell')">
                            <button class="cmd-btn sell-btn" id="btn-sell-kirin" onclick="executeOrder('kirin', 'sell')">CONFIRM</button>
                        </div>
                    </div>
                    <!-- ADHOC CMD -->
                    <div class="cmd-row">
                        <div class="cmd-top-row"><span class="cmd-label">ADHOC COMMANDER:</span></div>
                        <div class="cmd-controls adhoc-results-container">
                            <input type="text" class="cmd-input input-price" id="adhoc-search-kirin" placeholder="Name/Code">
                            <input type="number" class="cmd-input input-weight" id="adhoc-weight-kirin" placeholder="%" step="0.1">
                            <button class="cmd-btn buy-btn" onclick="addNewAdhoc('kirin')">ADHOC</button>
                            <div id="suggestions-kirin" class="suggestions-list-container"></div>
                        </div>
                    </div>
                    <div class="cmd-msg" id="msg-kirin"></div>
                </div>
                <div class="list-header">PORTFOLIO HOLDINGS (USER)</div>
                <div class="holdings-list portfolio-list" id="portfolio-kirin"></div>
            </div>
        </div>

        <!-- Settlement Panel: æ§åˆ¶æ˜¾ç¤ºä¸å¦ -->
        <div class="settlement-panel" id="settlementPanel">
            <h3 class="pixel-font" style="text-align:center;color:#fff;">Historical Performance</h3>
            <div class="chart-wrapper"><canvas id="performanceChart"></canvas></div>
        </div>

        <div class="system-controls">
            <button id="engageBtn" class="start-btn" onclick="initSystem()">[ ENGAGE SYSTEM ]</button>
            <div class="log-box" id="systemLog"><div class="log-line">> System Standby...</div></div>
        </div>

    </div> <!-- ã€NEWã€‘main-scaler ç»“æŸ -->

    <!-- ==================================================================== -->
    <!-- ä»¥ä¸‹æ¨¡æ€æ¡†å…¨éƒ¨ç§»å‡º main-scalerï¼Œä½œä¸º body çš„ç›´æ¥å­å…ƒç´ ï¼Œç¡®ä¿ position fixed å®šä½å‡†ç¡® -->
    <!-- ==================================================================== -->

    <!-- [æ–°å¢] åŠ¨æ€æ›²çº¿ Modal ç»“æ„ -->
    <div id="chartModal" class="modal-overlay" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div style="display: flex; align-items: baseline;">
                    <span id="modalTitle" class="pixel-font" style="font-size:1.2em; color:#FFD700;">STOCK</span>
                    <span id="modalCode" style="color:#888; margin-left:10px; font-family:'Roboto Mono';">(--)</span>
                    <span id="modalPct" style="margin-left:20px; font-weight:bold; font-size:1.4em;">0.00%</span>
                </div>
                <button class="close-btn" onclick="closeModal()">[X] CLOSE</button>
            </div>
            <div class="detail-chart-wrapper"><canvas id="detailChartCanvas"></canvas></div>
        </div>
    </div>

	<!-- SETTINGS MODAL -->
    <div id="settingsModal" class="modal-overlay" onclick="document.getElementById('settingsModal').style.display='none'">
        <!-- å®½åº¦ä¿æŒ 450px -->
        <div class="modal-content" style="height:auto; max-width:450px; border-color:#888;" onclick="event.stopPropagation()">
            <div class="modal-header">
                <span class="pixel-font" style="color:#fff;">SYSTEM SETTINGS</span>
                <button class="close-btn" onclick="document.getElementById('settingsModal').style.display='none'">[X]</button>
            </div>
            
            <!-- Github Proxy -->
            <div class="setting-row">
                <span class="switch-label">Github Proxy</span>
                <input type="checkbox" id="chkGitProxy" checked onchange="toggleProxy(this)" style="width:20px; height:20px; accent-color:#0f0;">
            </div>

            <!-- åˆ†å‰²çº¿ -->
            <div style="border-top: 1px dashed #444; margin: 15px 0 10px 0;"></div>
            
            <!-- OSS Config Title -->
            <div class="pixel-font" style="font-size: 0.7em; color: #FFD700; margin-bottom: 15px; text-align: center;">
                [ ALIYUN OSS LINK ]
            </div>

            <!-- OSS Fields -->
            <div style="display: flex; flex-direction: column; gap: 10px; padding: 0 10px;">
                <div style="display:flex; justify-content: space-between; align-items: center;">
                    <span class="switch-label" style="font-size: 0.7em; color:#aaa;">REGION:</span>
                    <input type="text" id="oss_region" class="cmd-input" style="width: 250px; color:#fff;" value="oss-cn-hangzhou">
                </div>
                <div style="display:flex; justify-content: space-between; align-items: center;">
                    <span class="switch-label" style="font-size: 0.7em; color:#aaa;">BUCKET:</span>
                    <input type="text" id="oss_bucket" class="cmd-input" style="width: 250px; color:#fff;" value="aiep-users">
                </div>
                
                <!-- ã€ä¿®æ”¹ç‚¹1ã€‘AccessKey ID æ”¹ä¸º password ç±»å‹ -->
                <div style="display:flex; justify-content: space-between; align-items: center;">
                    <span class="switch-label" style="font-size: 0.7em; color:#aaa;">AK ID:</span>
                    <input type="password" id="oss_ak_id" class="cmd-input" style="width: 250px; color:#fff;" value="">
                </div>
                
                <!-- AccessKey Secret ä¿æŒ password ç±»å‹ -->
                <div style="display:flex; justify-content: space-between; align-items: center;">
                    <span class="switch-label" style="font-size: 0.7em; color:#aaa;">SECRET:</span>
                    <input type="password" id="oss_ak_secret" class="cmd-input" style="width: 250px; color:#fff;" value="">
                </div>

				<!-- STS Role ARN ä¿æŒ password ç±»å‹ -->
                <div style="display:flex; justify-content: space-between; align-items: center;">
                    <span class="switch-label" style="font-size: 0.7em; color:#aaa;">ARN:</span>
                    <input type="password" id="oss_stc_rolearn" class="cmd-input" style="width: 250px; color:#fff;" value="">
                </div>
            </div>

            <!-- Save Button & Status Message -->
            <div style="padding:20px 10px 10px 10px; text-align: center;">
                <!-- ã€ä¿®æ”¹ç‚¹2ã€‘font-size è°ƒæ•´ä¸º 0.6emï¼Œpadding è°ƒæ•´ä¸º 10px -->
                <button class="cmd-btn buy-btn" style="width: 100% !important; padding: 10px; font-size: 0.6em;" onclick="saveOssSettings()">
                    UPDATE CONFIGURATION
                </button>
                
                <!-- çŠ¶æ€æç¤ºæ–‡å­—åŒºåŸŸ -->
                <div id="save-status-msg" class="pixel-font" style="height: 20px; margin-top: 10px; font-size: 0.6em; color: #10B981;"></div>
            </div>
        </div>
    </div>   
    
    <!-- RANKING MODAL -->
    <div id="rankingModal" class="modal-overlay" onclick="document.getElementById('rankingModal').style.display='none'">
        <div class="modal-content" style="border-color:#FFD700; height: 70vh;" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="pixel-font" style="color:#FFD700; font-size:1.2em;">Quant BATTLE RANKING</div>
                <button class="close-btn" onclick="document.getElementById('rankingModal').style.display='none'">[X]</button>
            </div>
            <div style="padding-bottom:10px; border-bottom:1px solid #333; margin-bottom:10px; display:flex; justify-content:space-between; color:#aaa; font-size:0.7em;">
                <span>ENTITY</span>
                <span>RETURN (%)</span>
            </div>
            <div id="rankingList" class="rank-list">
                <!-- åŠ¨æ€ç”Ÿæˆçš„å†…å®¹ -->
            </div>
        </div>
    </div>
   
    <script src="adhoc-manager.js"></script>
    <script src="applogic.js"></script>
    <script src="Rankingmodal.js"></script>
	<script src="usercalculation.js"></script>
	
	<script>
    	(function() {
	        // 1. è·å–å½“å‰ç³»ç»Ÿæ—¶é—´çš„å°æ—¶æ•° (0-23)
	        var currentHour = getChinaDate().getHours();
	        
	        // 2. è·å–éŸ³é¢‘å…ƒç´ 
	        var audioPlayer = document.getElementById('bgMusic');
	        
	        // 3. å®šä¹‰éŸ³ä¹æ–‡ä»¶è·¯å¾„
	        var dayMusic = "Legends of the Fall.mp3";
	        var nightMusic = "Deborah's Theme - Ennio Morricone.mp3";
	        
	        // 4. åˆ¤æ–­æ—¶é—´é€»è¾‘ï¼šæ—©7ç‚¹(åŒ…å«) åˆ° æ™š7ç‚¹(ä¸åŒ…å«) ä¹‹é—´
	        if (currentHour >= 7 && currentHour < 19) {
	            audioPlayer.src = dayMusic;
	        } else {
	            audioPlayer.src = nightMusic;
	        }
    	})();
	</script>
</body>
</html>
